var firebaseConfig={apiKey:"AIzaSyBrexUIWP1IPec_9VGh75d2JicgWdgVZu4",authDomain:"livingroom-1.firebaseapp.com",projectId:"livingroom-1",storageBucket:"livingroom-1.appspot.com",messagingSenderId:"516192485585",appId:"1:516192485585:web:b08232236003894cb685f0"};let bookingN,year,room,day,month,timeFrom,timeTo,tariff,key;firebase.initializeApp(firebaseConfig);const bdRooms=firebase.database().ref();let baseRooms,date=new Date;const months=["January","February","March","April","May","June","July","August","September","October","November","December"],freeTimes=["9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","24:00"];function Ready(){year=date.getFullYear(),room=$("input.form__heading").val(),day=$("input.form__day").val(),month=$("input.form__month").val(),timeFrom=+$("input.form__hourAt").val().split(":")[0],timeTo=+$("input.form__hourFrom").val().split(":")[0],tariff=$("input.form__tariff").val()}bdRooms.child("rooms").get().then(e=>{if(e.exists()){baseRooms=e.val();for(let e=0;e<10;e++){let t=new Date(date.getFullYear(),date.getMonth(),date.getDate()+e);const i=t.getFullYear(),a=months[t.getMonth()],s=t.getDate();for(const e in baseRooms)baseRooms[e][i]&&baseRooms[e][i][a]&&baseRooms[e][i][a][s]||firebase.database().ref(`rooms/${e}/${i}/${a}/${s}`).set({freeTimes:freeTimes})}}}).catch(e=>{console.log(e)}),$(".date__item").on("click",(function(){$("section.today").slideDown(),$(".time__take, section.welcome, section.tariff").slideUp(),$(".time__event").removeClass("time__event--active"),$(".time__confirm").removeClass("time__confirm--active").removeClass("time__confirm--checked"),$(".time__takeTo").text("..?."),bdRooms.child("events").get().then(e=>{if($(".time__item").remove(),$(".time__event").removeClass("time__eventPlus").removeClass("time__eventMinus"),e.exists()){baseEvents=e.val();const t=date.getFullYear(),i=$(this).children(".date__month").text(),a=$(this).children(".date__num").text();if(baseEvents[t]&&baseEvents[t][i]&&baseEvents[t][i][a]){const e=[13,14,15,19,20,21],s=+baseEvents[t][i][a].e1.timeFrom.split(":")[0];for(let e=s-1;e>=9;e--)$(".time__list").prepend($(`<li class="time__item">${e}:00</li>`));e.includes(s)||16===s&&$(window).width()>423?$(".time__event").addClass("time__eventPlus"):$(".time__event").addClass("time__eventMinus"),$(".time__eventFrom").text(s+":00"),$(".time__event").css("display","flex");const o=$(".today__events .today__item:first-of-type"),_=$(".today__events .today__item:last-of-type");$(o).find(".today__info h4").text(baseEvents[t][i][a].e1.name),$(o).children("img").attr("src",""+baseEvents[t][i][a].e1.photo),$(o).find(".today__info > div > span:last-of-type").text(baseEvents[t][i][a].e1.timeFrom),baseEvents[t][i][a].e2?($(_).css("visibility","visible"),$(_).find(".today__info h4").text(baseEvents[t][i][a].e2.name),$(_).children("img").attr("src",""+baseEvents[t][i][a].e2.photo),$(_).find(".today__info > div > span:last-of-type").text(baseEvents[t][i][a].e2.timeFrom)):$(_).css("visibility","hidden"),$(".today__events").removeClass("today__events--empty"),$(".today__events--heading").removeClass("today__events--heading--empty")}else{$(".time__event").css("display","none"),$(".today__events").addClass("today__events--empty"),$(".today__events--heading").addClass("today__events--heading--empty");for(let e=9;e<=24;e++)$(".time__list").append($(`<li class="time__item">${e}:00</li>`))}}let t,i,a;$("section.time").slideDown(),$(".time__item").on("click",(function(e){if($("section.welcome, section.tariff").slideUp(),$(".time__take").slideDown().css("display","flex"),$(".added").remove(),$(".time__item").removeClass("time__item--active-last"),$(".time__confirm").removeClass("time__confirm--active").removeClass("time__confirm--checked"),$(".time__event").removeClass("time__event--active"),$(".time__takeFrom").text($(this).text()),$(".time__takeTo").text("..?."),$(".form__hourAt").val($(this).text()),$(".form__hourFrom").val($(this).text()),$(".time__item").hasClass("time__item--active"))if(!$(this).hasClass("time__item--active")||$(this).next().hasClass("time__item--active")||$(this).prev().hasClass("time__item--active")){$(t).removeAttr("style"),t=void 0,$(this).addClass("timeOut");let e,s,o=$(".time__item");for(let t=0;t<o.length;t++)$(o[t]).hasClass("time__item--active")&&void 0===e&&(e=t),$(o[t]).hasClass("timeOut")&&(s=t);if($(".time__item").removeClass("time__item--active"),$(".time__item").removeClass("time__item--last"),$(".time__item").removeAttr("style"),$(".time__item").removeClass("timeOut"),e<s){for(let t=e;t<=s;t++)$(o[t]).addClass("time__item--active");$(o[e]).css("border-radius","10px 0 0 10px"),$(o[s]).css("border-radius","0 10px 10px 0").addClass("time__item--last"),$(".form__hourAt").val($(o[e]).text()),$(".form__hourFrom").val($(o[s]).text()),$(".time__takeFrom").text($(o[e]).text()),$(".time__takeTo").text($(o[s]).text()+")"),i=+$(o[e]).text().split(":")[0],a=+$(o[s]).text().split(":")[0],$(".time__confirm").addClass("time__confirm--active")}if(e===s&&($(o[e]).addClass("time__item--active").css("border-radius","10px"),$(".time__takeFrom").text($(o[e]).text()),$(".time__takeTo").text("..?."),$(".time__confirm").removeClass("time__confirm--active")),e>s){for(let t=s;t<=e;t++)$(o[t]).addClass("time__item--active");$(o[e]).css("border-radius","0 10px 10px 0"),e===s?$(o[s]).css("border-radius","10px").addClass("time__item--last"):$(o[s]).css("border-radius","10px 0 0 10px"),$(".form__hourAt").val($(o[s]).text()),$(".form__hourFrom").val($(o[e]).text()),$(".time__takeFrom").text($(o[s]).text()),$(".time__takeTo").text($(o[e]).text()+")"),i=+$(o[s]).text().split(":")[0],a=+$(o[e]).text().split(":")[0],$(".time__confirm").addClass("time__confirm--active")}}else $(this).removeClass("time__item--active"),$(this).removeClass("time__item--last"),$(this).removeAttr("style");else $(this).addClass("time__item--active"),$(this).addClass("time__item--last"),$(this).css("border-radius","10px"),t=$(this);let s=$(".time__item--active");$(s).append($('<span class="added"></span>')),$(s[s.length-1]).children(".added").remove(),$(".time__count").text(s.length)})),$(".time__event").on("click",(function(){let e=$(".time__item");$("section.welcome, section.tariff").slideUp(),$(".time__confirm").removeClass("time__confirm--active").removeClass("time__confirm--checked"),$(e).removeClass("time__item--active").removeClass("time__item--last");for(let t=1;t<e.length-1;t++)$(e[t]).css("border-radius","0");$(this).addClass("time__event--active");let t=+$(".time__eventFrom").text().split(":")[0],i=+$(".time__eventTo").text().split(":")[0];$(".time__count").text(i-t),$(".time__takeFrom").text(t+":00"),$(".time__takeTo").text(i+":00)"),$("input.form__hourAt").val(t+":00"),$("input.form__hourFrom").val(i+":00"),$(".time__take").slideDown().css("display","flex"),$(".time__confirm").addClass("time__confirm--active")})),$(".time__confirm").on("click",(function(){$(this).addClass("time__confirm--checked"),$(".welcome__item").remove(),bdRooms.child("rooms").get().then(e=>{if(Ready(),$(".welcome__item").remove(),e.exists()){baseRooms=e.val();let t=[];for(const e in baseRooms)for(let i=timeFrom;i<=timeTo&&baseRooms[e][year][month][day].freeTimes.includes(i+":00");i++)i===timeTo&&t.push(baseRooms[e]);for(const e of t){const t=e.photo,i=e.name,a=e.cardText,s=e.key,o=$(".welcome__item--none").clone();$(o).find(".welcome__photo img").attr("src",t),$(o).find(".welcome__title").text(i),$(o).find(".welcome__paragraph").text(a),$(o).find(".welcome__key").text(s),$(o).removeClass("welcome__item--none").addClass("welcome__item"),$(".welcome__list").append($(o))}$(".form .welcome__advantages a").on("click",(function(e){e.preventDefault(),$(".welcome__item").removeClass("welcome__item--active"),$(this).parent().parent().parent().addClass("welcome__item--active"),$("section.tariff").slideDown(),$("input.form__heading").val($(this).parent().parent().parent().find(".welcome__title").text()),key=$(this).parent().parent().parent().find(".welcome__key").text(),$(".tariff__button, .tariff__card").on("click",(function(){$(".tariff__button").removeClass("tariff__button--active"),$(this).addClass("tariff__button--active"),($(this).hasClass("1")||$(this).hasClass("tariff__card:nth-child(1)"))&&($(".tariff__cards").slideDown(),$(".tariff__button").removeClass("tariff__button--active"),$(".tariff__button:nth-child(1)").addClass("tariff__button--active"),$(".tariff__cards").css({display:"flex",right:"0px"}),$(".tariff__card").removeClass("tariff__card--active"),$(".tariff__card:nth-child(1)").addClass("tariff__card--active"),$(".form__tariff").val($(".tariff__button:nth-child(1) p:first-of-type").text())),($(this).hasClass("2")||$(this).hasClass("tariff__card:nth-child(2)"))&&($(".tariff__cards").slideDown(),$(".tariff__button").removeClass("tariff__button--active"),$(".tariff__button:nth-child(2)").addClass("tariff__button--active"),$(".tariff__cards").css({display:"flex",right:"319px"}),$(".tariff__card").removeClass("tariff__card--active"),$(".tariff__card:nth-child(2)").addClass("tariff__card--active"),$(".form__tariff").val($(".tariff__button:nth-child(2) p:first-of-type").text())),($(this).hasClass("3")||$(this).hasClass("tariff__card:nth-child(3)"))&&($(".tariff__cards").slideDown(),$(".tariff__button").removeClass("tariff__button--active"),$(".tariff__button:nth-child(3)").addClass("tariff__button--active"),$(".tariff__cards").css({display:"flex",right:"638px"}),$(".tariff__card").removeClass("tariff__card--active"),$(".tariff__card:nth-child(3)").addClass("tariff__card--active"),$(".form__tariff").val($(".tariff__button:nth-child(3) p:first-of-type").text())),$(".tariff__submit").addClass("button--active"),$(".tariff__submit").on("click",(function(e){e.preventDefault(),Ready();const t=firebase.database().ref();let i;t.child("rooms").get().then(e=>{if(e.exists()){i=e.val();let t=i[key][year][month][day].freeTimes;const a=t.indexOf(timeFrom+":00"),s=timeTo-timeFrom+1;t.splice(a,s),firebase.database().ref(`rooms/${key}/${year}/${month}/${day}/freeTimes`).set(0!==t.length?t:"notFreeTime")}}).catch(e=>{console.error(e)}),t.child("booking").get().then(e=>{if(e.exists())if(i=e.val(),i[year][month]&&i[year][month][day]){let e="";for(const t in i[year][month][day][room])e=t;bookingN="booking "+(+e.split(" ")[1]+1)}else bookingN="booking 1";else bookingN="booking 1";firebase.database().ref(`booking/${year}/${month}/${day}/${room}/${bookingN}`).set({room:room,day:day,month:month,timeFrom:timeFrom+":00",timeTo:timeTo+":00",tariff:tariff});let t=`Hi,%20I%20want%20to%20book%20${room}%20capsule%20in%20LR.%20${month}%20${day},%20from%20${timeFrom}:00%20to%20${timeTo}:00%20(${tariff}%20tariff).`,a=`https://zarva6596.github.io/livingRoom/capsule-ticket.html?${key}=${month}=${day}=${timeFrom}=${timeTo}`;document.location.href=`https://api.whatsapp.com/send?phone=380638373845&text=${t}%20${a}`}).catch(e=>{console.error(e)})}))}))}))}}).catch(e=>{console.log(e)}),$("section.welcome").slideDown()}))}).catch(e=>{console.log(e)})}));